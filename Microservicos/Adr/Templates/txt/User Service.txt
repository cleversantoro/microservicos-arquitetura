ğŸ“Œ Modelo C4 - User Service (MicroserviÃ§o do E-commerce)
ğŸ”¹ NÃ­vel 1: Diagrama de Contexto
O User Service Ã© um dos principais microserviÃ§os do e-commerce. Ele gerencia usuÃ¡rios, perfis e autenticaÃ§Ã£o.

ğŸ“Œ Principais elementos:

UsuÃ¡rio Cliente â†’ Registra-se e gerencia seus dados no sistema.
Sistema de E-commerce â†’ Plataforma central que usa o User Service para gerenciar perfis.
ServiÃ§os Externos:
Sistema de AutenticaÃ§Ã£o (Auth0, Firebase, Keycloak)
Banco de Dados de UsuÃ¡rios (PostgreSQL)
ğŸ“Œ Diagrama do Contexto:

lua
Copiar
Editar
+----------------------------+
|   Cliente (UsuÃ¡rio)        |
+----------------------------+
            |
            v
+--------------------------------------+
|          Sistema de E-commerce      |
|--------------------------------------|
| - MicroserviÃ§os para pedidos,       |
|   pagamentos e usuÃ¡rios.            |
+--------------------------------------+
            |
            v
+-------------------+
|  User Service    |
+-------------------+
        |
        v
+---------------------------+
|  Banco de Dados (Postgre) |
+---------------------------+
ğŸ”¹ NÃ­vel 2: Diagrama de ContÃªineres
Aqui detalhamos os contÃªineres que compÃµem o User Service.

ğŸ“Œ Principais ContÃªineres:

Frontend Web (React/Next.js) â†’ Interage com a API do User Service.
API Gateway (NestJS / Spring Cloud Gateway) â†’ Roteia as requisiÃ§Ãµes para o User Service.
User Service â†’ ServiÃ§o responsÃ¡vel pelo gerenciamento de usuÃ¡rios.
Banco de Dados (PostgreSQL) â†’ Armazena os perfis de usuÃ¡rios.
AutenticaÃ§Ã£o Externa (Auth0, Firebase, Keycloak) â†’ Gerencia login e autenticaÃ§Ã£o.
ğŸ“Œ Diagrama de ContÃªineres:

lua
Copiar
Editar
+--------------------------------------+
|         Sistema de E-commerce       |
|--------------------------------------|
|  +--------+   +-----------------+   |
|  | WebApp |   | API Gateway      |   |
|  +--------+   +-----------------+   |
|      |              |               |
|      v              v               |
|  +------------+    +------------+   |
|  | UserSvc    | -> | Auth System |  |
|  +------------+    +------------+   |
|          |                 |
|          v                 v
|  +------------+    +----------------+
|  | PostgreSQL |    |  External Auth  |
|  +------------+    +----------------+
+--------------------------------------+
âœ… ExplicaÃ§Ã£o:

O Frontend Web faz chamadas ao API Gateway, que repassa as requisiÃ§Ãµes ao User Service.
O User Service interage com um banco PostgreSQL para armazenar os dados dos usuÃ¡rios.
A autenticaÃ§Ã£o pode ser feita atravÃ©s de Auth0, Firebase ou Keycloak.
ğŸ”¹ NÃ­vel 3: Diagrama de Componentes
Agora, detalhamos os componentes internos do User Service.

ğŸ“Œ Componentes:

UserController â†’ ExpÃµe endpoints REST.
UserService â†’ ContÃ©m a lÃ³gica de negÃ³cios.
UserRepository â†’ Interage com o banco de dados.
AuthClient â†’ Se comunica com sistemas externos de autenticaÃ§Ã£o.
ğŸ“Œ Diagrama de Componentes:

lua
Copiar
Editar
+------------------------+
|      User Service      |
+------------------------+
      |          |
      v          v
+------------+  +------------+
| UserCtrl   |->| UserSrv    |
+------------+  +------------+
       |              |
       v              v
+------------+   +------------+
| UserRepo   |   | AuthClient |
+------------+   +------------+
       |              |
       v              v
+------------+   +------------+
| PostgreSQL |   | Auth System |
+------------+   +------------+
âœ… ExplicaÃ§Ã£o:

O UserController recebe as requisiÃ§Ãµes HTTP.
O UserService processa as regras de negÃ³cios.
O UserRepository acessa o banco de dados.
O AuthClient interage com o sistema externo de autenticaÃ§Ã£o.
ğŸ”¹ NÃ­vel 4: CÃ³digo
Aqui estÃ¡ um exemplo real de implementaÃ§Ã£o do User Service em Node.js (Express).

ğŸ“Œ 1ï¸âƒ£ UserController.js

javascript
Copiar
Editar
const express = require("express");
const UserService = require("../services/UserService");
const router = express.Router();

router.post("/users", async (req, res) => {
    try {
        const user = await UserService.createUser(req.body);
        res.status(201).json(user);
    } catch (err) {
        res.status(400).json({ error: err.message });
    }
});

router.get("/users/:id", async (req, res) => {
    try {
        const user = await UserService.getUserById(req.params.id);
        res.json(user);
    } catch (err) {
        res.status(404).json({ error: "UsuÃ¡rio nÃ£o encontrado" });
    }
});

module.exports = router;
ğŸ“Œ 2ï¸âƒ£ UserService.js

javascript
Copiar
Editar
const UserRepository = require("../repositories/UserRepository");
const AuthClient = require("../clients/AuthClient");

class UserService {
    static async createUser(userData) {
        // Verifica se o usuÃ¡rio jÃ¡ existe
        const existingUser = await UserRepository.findByEmail(userData.email);
        if (existingUser) throw new Error("UsuÃ¡rio jÃ¡ cadastrado");

        // Cria usuÃ¡rio no sistema externo de autenticaÃ§Ã£o
        const authUser = await AuthClient.createUser(userData);
        if (!authUser) throw new Error("Erro ao criar usuÃ¡rio");

        // Salva no banco de dados
        return await UserRepository.create(userData);
    }

    static async getUserById(userId) {
        return await UserRepository.findById(userId);
    }
}

module.exports = UserService;
ğŸ“Œ 3ï¸âƒ£ UserRepository.js

javascript
Copiar
Editar
const db = require("../config/database");

class UserRepository {
    static async create(userData) {
        const { email, name } = userData;
        const result = await db.query("INSERT INTO users (email, name) VALUES ($1, $2) RETURNING *", [email, name]);
        return result.rows[0];
    }

    static async findById(userId) {
        const result = await db.query("SELECT * FROM users WHERE id = $1", [userId]);
        return result.rows[0];
    }

    static async findByEmail(email) {
        const result = await db.query("SELECT * FROM users WHERE email = $1", [email]);
        return result.rows[0];
    }
}

module.exports = UserRepository;
ğŸ“Œ 4ï¸âƒ£ AuthClient.js

javascript
Copiar
Editar
const axios = require("axios");

class AuthClient {
    static async createUser(user) {
        try {
            const response = await axios.post("http://authservice:4000/auth/register", {
                email: user.email,
                password: user.password
            });
            return response.data;
        } catch (err) {
            return null;
        }
    }
}

module.exports = AuthClient;
ğŸ¯ ConclusÃ£o
Agora temos um User Service completamente modelado segundo o Modelo C4, incluindo:
âœ… NÃ­vel 1 - Contexto â†’ Mostra a interaÃ§Ã£o do User Service com o sistema.
âœ… NÃ­vel 2 - ContÃªineres â†’ Define as principais aplicaÃ§Ãµes envolvidas.
âœ… NÃ­vel 3 - Componentes â†’ Estrutura interna do User Service.
âœ… NÃ­vel 4 - CÃ³digo â†’ ImplementaÃ§Ã£o real em Node.js.

ğŸš€ Essa arquitetura permite escalabilidade, seguranÃ§a e fÃ¡cil manutenÃ§Ã£o para o gerenciamento de usuÃ¡rios no e-commerce!

Se precisar de mais ajustes ou dÃºvidas, me avise! ğŸ˜Š





